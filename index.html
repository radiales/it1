<!doctype html>
<html>
	<head>
		<title>Noten lernen</title>
		<meta charset="utf-8">
		<style>
            *{
                font-family: Segoe UI, Helvetica, Trebuchet, Arial, Serif;
            }
		
            .answer{
                display: inline-block;
                background: #AFAFAF;
                margin-bottom: 5px;
                padding: 10px 10px 10px 10px;
				width: 45%;
				cursor: pointer;
			}
			
			.answer:hover{
				background: #BFBFBF;
			}
            
            #container{
                border-radius: 25px;
                display: block;
                margin: 0 auto;
                width: 80%;
                text-align: center;
                padding-bottom: 35px;
                padding-top: 25px;
                background: #DFDFDF;
            }
			
			#progressIndicator{
				margin-top: 25px;
				display: table;
				width: 100%;
				height: 20px;
				background: white;
				padding: 5px 0px 5px 0px;
			}
			
			#progressBar{
				width: 0%;
				height: 100%;
				background: #a7e3bc;
				display: block;
			}
			
			#statistics{
				background: #CACACA;
				margin-top: 15px;
			}
		</style>
	</head>
	<body>
        <script src="https://unpkg.com/vexflow@1.2.89/releases/vexflow-debug.js"></script>
        <div id="container">
            <h1>Noten lernen</h1>
            <div id="scoreDiv"></div>
			<div id="answers">
				<div id="answer1" class="answer">A3</div>
				<div id="answer2" class="answer">B4</div>
				<div id="answer3" class="answer">D4</div>
				<div id="answer4" class="answer">D3</div>
			</div>
			<div id="statistics">
				<span>Statistik:</span><br>
				<canvas id="piechart" width="200" height="200">
				</canvas>
				<br>
				Richtige: <span id="correctNo">0</span>
				Falsche: <span id="wrongNo">0</span>
			</div>
			<div id="progressIndicator">
				<div id="progressBar"></div>
			</div>
		</div>
		
		<script>
		/*
		var vf = new Vex.Flow.Factory({
				renderer: {elementId: 'scoreDiv', width: 80, height: 125}
			});
	
			var score = vf.EasyScore();
			var system = vf.System();
	
			system.addStave({
				voices: [score.voice(score.notes('C4/q, B4, A4, G#4'))]
			}).addClef('treble');
	
			vf.draw();
		*/
		
		var vf = new Vex.Flow.Factory({
			renderer: {elementId: 'scoreDiv', width: 80, height: 125}
		});
		
		var score = vf.EasyScore();
		var system = vf.System();
		var notegroup;
		
		function setupVF(note){
			//vf.context.setFillStyle("#DFDFDF");
			//vf.context.fillRect(-5, -5, 500, 500);
			//vf.context.setFillStyle("black");
		
			//if(notegroup != undefined)
				//vf.context.svg.removeChild(notegroup);
				
			notegroup = vf.context.openGroup();
		
			system.addStave({
				voices: [score.voice(score.notes(note+'/q, B4, A4, G#4'))]
			}).addClef('treble');

			vf.draw();
			
			vf.context.closeGroup();
		}
		
		var piechart = document.querySelector("#piechart");
		var context = piechart.getContext("2d");
		
		var possibleNotes = ["C", "D", "E", "F", "G", "A", "H"];
		var notes = ["D4", "C3", "E5", "F4", "H3"];
		var questionCounter = 0;
		var correctNo = 0;
		
		setupVF(notes[0]);
		
		//Draws a pie chart showing the relation between correct and incorrect answers 
		function drawPieChart(){
		
			var correctCount = correctNo;
			if(questionCounter == 0)
				correctCount = notes.length;
		
			context.moveTo(100, 100);
			context.arc(100, 100, 90.5, 0, Math.PI*(correctCount/notes.length)*2);
			context.fillStyle = "#a7e3bc";
			context.fill();
			
			context.beginPath();
			context.moveTo(100, 100);
			context.arc(100, 100, 90.5, Math.PI*(correctCount/notes.length)*2, Math.PI*2);
			context.fillStyle = "#e19898";
			context.fill();
		}
		
		//Updates question divs and VexFlow note display
		function update(){
			//function is ensured to never use one answer twice and selects random div for correct answer, fills others with incorrects
			var answers = document.querySelectorAll(".answer");
			var correctIndex = Math.floor(Math.random()*3);
			var lastIndex;
			var tempPossible = possibleNotes;
			
			for(var i = 0; i < answers.length; i++)
				answers[i].style.background = "#AFAFAF";
			
			answers[correctIndex].innerHTML = notes[questionCounter];
			for(var i = 0; i < 3; i++){
				if(i == correctIndex) continue;
				lastIndex = Math.floor(Math.random()*tempPossible.length);
				answers[i] = possibleNotes[lastIndex];
				tempPossible.splice(lastIndex, 1);
			}
			
			setupVF(notes[questionCounter]);
			drawPieChart();
			document.querySelector("#correctNo").innerHTML = correctNo;
			document.querySelector("#wrongNo").innerHTML = questionCounter - correctNo;
			document.querySelector("#progressBar").style.width = questionCounter/notes.length*100 + "%";
			console.log("Progress percentage: " + questionCounter/notes.length*100 + "%");
		}
		
		//Is called when the user clicks on one of the answer divs, invokes update after 1 second, to show correct answer
		function answer(note){
			console.log("User answered.");
			var answers = document.querySelectorAll(".answer");
			console.log("Correct answer would be:" + notes[questionCounter]);
			console.log("Answer was:" + note);
			if(note == notes[questionCounter]){
				correctNo++;
			}
			
			for(var i = 0; i < answers.length; i++){
			console.log("innerHTML: " + answers[i].innerHTML);
			console.log("answer: " + notes[questionCounter]);
				if(answers[i].innerHTML == notes[questionCounter])
					answers[i].style.background = "#a7e3bc";
				else
					answers[i].style.background = "#e19898";
				//console.log("Div No. " + i + " innerHTML: " + answers[i].innerHTML);
			}
			
			questionCounter++;
			setTimeout(update, 1000);
		}
		
		//Setting up event-listeners for answering
		var answers = document.querySelectorAll(".answer");
		for(var i = 0; i < answers.length; i++){
			answers[i].addEventListener("click", function(){
				answer(this.innerHTML);
			});
		}
		
		drawPieChart();
		</script>
	</body>
</html>
